---
import WeeklyOverview from '../components/WeeklyOverview.jsx';
import spots from "../data/spots_with_wind_top50.json"; // deze moet in src/data blijven voor build
import fs from 'fs';
import path from 'path';

// ✅ Tijdens build: alle mogelijke spotId's doorgeven aan Astro
export async function getStaticPaths() {
  return spots.map((spot) => ({
    params: { spotId: spot.spotId },
  }));
}

const { spotId } = Astro.params;

// ✅ Tijdens runtime: forecast-data direct uit bestand lezen
let forecastData = {};
try {
  const forecastPath = path.join(process.cwd(), 'public', 'data', 'forecastData', `${spotId}.json`);
  console.log(`Reading forecast data from: ${forecastPath}`);
  
  if (fs.existsSync(forecastPath)) {
    const fileContent = fs.readFileSync(forecastPath, 'utf8');
    forecastData = JSON.parse(fileContent);
    console.log(`Loaded forecast data for ${spotId}:`, Object.keys(forecastData));
  } else {
    console.error(`Forecast file not found: ${forecastPath}`);
  }
} catch (err) {
  console.error(`Error loading forecast data for ${spotId}:`, err);
}
---

<html lang="nl">
  <head>
    <style is:global>
      @import "../styles/global.css";
    </style>
    <meta charset="UTF-8" />
    <title>Kitesurf Voorspelling – {spotId}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  </head>
  <body class="bg-amber-50 font-sans text-gray-800 min-h-screen">
    <header class="bg-cyan-700 text-white text-center p-4">
      <h1 class="text-2xl md:text-3xl font-semibold">
        Kitesurf Voorspelling – {spotId}
      </h1>
    </header>

    <main class="px-4 md:px-12 lg:px-24 py-6">
      {Object.keys(forecastData).length > 0 ? (
        <WeeklyOverview client:only="react" forecastData={forecastData} spotId={spotId} />
      ) : (
        <div class="text-center py-8">
          <p class="text-gray-600">Geen forecast data beschikbaar voor {spotId}</p>
          <p class="text-sm text-gray-500 mt-2">Controleer of het bestand /data/forecastData/{spotId}.json bestaat</p>
        </div>
      )}
    </main>
  </body>
</html>
